# 변경 가능성을 최소화하라

불변 클래스는 가변 클래스보다 설계하고 구현하고 사용하기 쉬우며 오류가 생길 여지도 적고 훨씬 안전하다

## 클래스를 불변으로 만드는 방법

1. 객체의 상태를 변경하는 메소드(변경자)를 제공하지 않는다.  
   클래스에 setter 메소드를 제공하지 않고, 모든 값을 생성자를 통해 한 번만 설정
2. 클래스를 확장할 수 없도록 한다.  
   클래스를 final로 선언하거나 모든 생성자를 private 또는 package-private으로 선언하고, public 정적 팩토리를 제공
3. 모든 필드를 final로 선언한다.
4. 모든 필드를 private으로 선언한다.  
   내부 표현을 바꾸지 못하는 public final보다는 private 필드를 사용
5. 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.  
   내부의 가변 객체를 외부에 직접 반환하지 않고, 필요한 경우 방어적 복사본을 생성하여 반환

## 불변 객체

불변 객체는 함수형 프로그래밍을 적용하기에 적합하다.

### 함수형 프로그래밍

피연사자에 함수를 적용해 그 결과를 반환하지만, 피연산자 자체는 그대로인 프로그래밍 패턴. 해당 메소드가 객체의 값을 변경하지 않는다는 사실을 강조하기 위해 명명 규칙도 바뀜(동사 add 대신 전치사 plus 사용)

### 장점과 단점

#### 장점

- 단순성: 객체가 절대 변하지 않으므로, 복잡한 상태 관리 없이도 오류를 방지할 수 있음
- 스레드 안전: 불변 객체는 내부 상태가 변경될 수 없으므로, 별도의 동기화 없이 여러 스레드에서 안전하게 사용할 수 있음
- 재사용성: 불변 객체는 안전하게 공유될 수 있으므로, 같은 객체 인스턴스를 여러 클라이언트에 재사용할 수 있음
- 실패 원자성: 메소드에서 예외가 발생해도 객체의 내부 상태가 변하지 않았으니
  메소드 호출 전과 같은 유효한 상태를 제공

#### 단점

- 성능 문제: 상태 변경이 필요할 때마다 새 객체를 생성해야 하므로, 객체 생성과 가비지 컬렉션에 따른 오버헤드가 발생할 수 있습니다.

## 불변으로 만들지 못하는 클래스

- 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분을 최소한으로 줄이자
- 합당한 이유가 없다면 모든 필드는 private final이어야 한다
- 생성자는 불변식 설정이 모두 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성해야 한다.
