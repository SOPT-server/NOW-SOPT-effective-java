정원-5주차-아이템19_상속을_고려해_설계하고_문서화하라._그러지_않았다면_상속을_금지하라

상속용 클래스는 재정의할 수 있는 메서드들을 내부적으로 어떻게 이용하는지 문서로 남겨야 한다.

클래스의 API로 공개된 메서드에서 클래스 자신의 또 다른 메서드를 호출할 수도 있다. 또한 그 메서드가 재정의 가능 메서드(protected, public 중 final이 아닌 모든 메서드)라면 그 사실을 호출하는 메서드의 API 설명에 적시해야 한다.

@implSpec 태그

- 자바 8에서 처음 도입되어 자바9부터 사용되기 시작했다. 자바 11 자바독에서까지 선택사항으로 남아있다.
- 이 태그를 활성화하려면 명령줄 매개변수로 tag "implSpec:a:Implementation Requirements:"를 지정해주면 된다.

좋은 API문서란?

- 좋은 API문서란 어떻게 가 아닌 무엇을 하는지를 설명해야한다. 클래스를 안전하게 상속할 수 있도록 하려면 (상속만 아니었다면 기술하지 않았어야 할) 내부구현 방식을 설명해야만 한다.

효율적인 하위 클래스를 만들기 위해선

- 효율적인 하위 클래스를 큰 어려움 없이 만들려면 내부 매커니즘을 문서로 남기는것뿐만 아니라 클래스의 내부 동작 과정 중간에 끼어들 수 있는 훅(hook)을 잘 선별하여 protected 메서드 형태로 공개해야 할 수도 있다.

protected로 노출해야하는 메서드 선택방법

- 가능한 숫자가 적어야 한다. 다만, 너무 적게 노출해서 상속으로 얻는 이점을 없애는일이 없도록해야 한다.
- 상속용 클래스를 시험하는 방법은 직접 하위클래스를 만드는 방법이 유일하다.
    - 하위 클래스 검증 개수로는 3개정도가 적정하다.
- 꼭 필용한 protected 멤버를 놓쳤다면 하위 클래스 작성시 그 빈자리가 드러난다.
- 하위 클래스를 여러개 만들 때까지 전혀 쓰이지않는 protected 멤버는 사실 private 이어야 할 가능성이 크다.

클래스 상속시 주의사항

- 클래스를 상속용으로 설계하려면 엄청난 노력이 들고 그 클래스에 안기는 제약도 상당하다.
- 추상 클래스나 인터페이스의 골격구현처럼 상속을 허용하는게 명백히 정당한 상황이 있고 불변 클래스처럼 명백히 잘못된 상황이 있다.
- 일반적인 구체 클래스는 final도 아니고 상속용으로 설계되거나 문서화되지 않아 그대로 두면 위험하다. 클래스 변화시 오작동이 발생할 가능성이 있기 때문이다.

상속을 금지하는 두가지 방법

- 클래스를 final로 선언하는 방법
- 생성자를 private 이나 package-private으로 선언하고 public 정적 팩터리를 만들어주는 방법

만약, 핵심기능을 정의한 인터페이스가 있고, 클래스가 그 인터페이스를 구현했다면 상속을 금지해도 괜찮다.

상속을 꼭 허용해야 한다면?

- 클래스 내부에서는 재정의 가능 메서드를 사용하지 않게한다.
- 해당 사실을 문서로 남긴다.